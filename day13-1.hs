{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

-}

{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

-}
{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

-}

{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

-}
{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

-}

{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

-}
{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

-}

{-
== Day 13: Part 1 - Transparent Origami

We are given input data of x,y coords and fold instructions.

The idea is to fold the associated array of points either vertically (x) or
horizontally (y). Areas that were previusly occupied remain. Folds

=== Example

  ...#..#..#.
  ....#......
  ...........
  #..........
  ...#....#.#
  ...........
  ...........
  ----------- <- fold array here, y = 7
  ...........
  ...........
  ...........
  .#....#.##.
  ....#......
  ......#...#
  #..........
  #.#........

Fold along y=7 gives a new array:

  #.##..#..#.
  #...#......
  ......#...#
  #...#......
  .#.#..#.###
  ...........
  ...........

=== Input

In 2 parts with first part being numbers separated by comma's, the second
part provides the fold instructions.

  2,14
  8,10
  9,0

  fold along y=7
  fold along x=5

== Answer

make check day13-1

cat day13.test | ./day13-1
17

cat day13.data | ./day13-1
647

-}
import           Data.Bifunctor  (bimap)
import           Data.List.Split (splitOn)
import qualified Data.Set        as S (Set, fromList, map, size)

data Axis = XAxis | YAxis deriving (Show, Eq)
type Fold = (Axis, Int)
type Point = (Int, Int)
type Input = (S.Set Point, [Fold])

-- Parse the input:
--  1. part one is list of comma-separated numbers
--  2. part two is list of fold instructions
parse :: String -> Input
parse input = (S.fromList points, folds)
  where
    [pointsStr, foldsStr] = splitOn "\n\n" input -- split input into two parts
    points = map parsePoint $ lines pointsStr
    folds = map parseFold $ lines foldsStr

parsePoint :: String -> Point
parsePoint str = (x, y)
  where
    [x, y] = map read (splitOn "," str) -- parse points

parseFold :: String -> Fold
parseFold str = bimap parseAxis read (a, b) -- parse fold instructions
  where
    [a:_,b] = splitOn "=" . drop 11 $ str

parseAxis :: Char -> Axis
parseAxis 'x' = XAxis
parseAxis 'y' = YAxis
parseAxis _   = error "Invalid axis"

-- Fold a point along a given axis.
fold :: Fold -> Point -> Point
fold (XAxis, n) (x, y) = (n - abs(x-n), y)
fold (YAxis, n) (x, y) = (x, n - abs(n-y))

solve :: Input -> Int
solve (points, firstFold:_) = S.size $ S.map (fold firstFold) points
solve _                     = error "Invalid input"

main :: IO ()
main = interact $ show . solve . parse
